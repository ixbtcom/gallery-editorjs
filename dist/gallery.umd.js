(function(){"use strict";try{if(typeof document<"u"){var o=document.createElement("style");o.appendChild(document.createTextNode('.gallery-tool{--bg-color: #f5f5f5;--border-color: #e8e8eb;--accent-color: #388ae5;--control-bg: rgba(255, 255, 255, .9);--control-hover: rgba(0, 0, 0, .05);max-width:100%;box-sizing:border-box;overflow:hidden}.gallery-tool__items{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:12px;max-width:100%;box-sizing:border-box}.gallery-tool--columns-1 .gallery-tool__item{flex:0 0 100%;max-width:100%}.gallery-tool--columns-2 .gallery-tool__item{flex:0 0 calc(50% - 6px);max-width:calc(50% - 6px)}.gallery-tool--columns-3 .gallery-tool__item{flex:0 0 calc(33.333% - 8px);max-width:calc(33.333% - 8px)}.gallery-tool--columns-4 .gallery-tool__item{flex:0 0 calc(25% - 9px);max-width:calc(25% - 9px)}.gallery-tool--columns-5 .gallery-tool__item{flex:0 0 calc(20% - 10px);max-width:calc(20% - 10px)}.gallery-tool__item{position:relative;border:1px solid var(--border-color);border-radius:4px;overflow:hidden;background:#fff;box-sizing:border-box;min-width:0}.gallery-tool__item-image{position:relative;min-height:120px;background:var(--bg-color);overflow:hidden}.gallery-tool__item-image img{width:100%;height:auto;display:block;object-fit:cover;max-height:400px;max-width:100%}.gallery-tool__item-preloader{width:50px;height:50px;border-radius:50%;background-size:cover;background-position:center;margin:35px auto;position:relative;background-color:var(--bg-color)}.gallery-tool__item-preloader:after{content:"";position:absolute;width:60px;height:60px;border-radius:50%;border:2px solid var(--bg-color);border-top-color:var(--accent-color);left:50%;top:50%;margin:-30px 0 0 -30px;animation:gallery-preloader-spin 1s infinite linear;box-sizing:border-box}@keyframes gallery-preloader-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.gallery-tool__item-caption,.gallery-tool__item-source,.gallery-tool__item-source-link{padding:8px 10px;font-size:13px;line-height:1.4;border-top:1px solid var(--border-color);min-height:20px;outline:none}.gallery-tool__item-caption{font-weight:500}.gallery-tool__item-source{color:#666;font-size:12px}.gallery-tool__item-source-link{color:var(--accent-color);font-size:12px}.gallery-tool__item-caption[data-placeholder]:empty:before,.gallery-tool__item-source[data-placeholder]:empty:before,.gallery-tool__item-source-link[data-placeholder]:empty:before{content:attr(data-placeholder);color:#aaa;pointer-events:none}.gallery-tool__item-caption[data-placeholder]:empty:focus:before,.gallery-tool__item-source[data-placeholder]:empty:focus:before,.gallery-tool__item-source-link[data-placeholder]:empty:focus:before{display:none}.gallery-tool__item-dimensions{position:absolute;bottom:8px;left:8px;padding:2px 6px;background:#0009;color:#fff;font-size:11px;font-family:monospace;border-radius:3px;z-index:5;pointer-events:none}.gallery-tool__item-controls{position:absolute;top:8px;right:8px;display:flex;gap:4px;opacity:0;transition:opacity .2s;z-index:10}.gallery-tool__item:hover .gallery-tool__item-controls{opacity:1}.gallery-tool__item-remove,.gallery-tool__item-move-left,.gallery-tool__item-move-right{width:28px;height:28px;border:none;border-radius:4px;background:var(--control-bg);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;color:#333;transition:background .2s}.gallery-tool__item-remove:hover,.gallery-tool__item-move-left:hover,.gallery-tool__item-move-right:hover{background:var(--control-hover)}.gallery-tool__item-remove{color:#e74c3c}.gallery-tool__add-buttons{display:flex;gap:10px;align-items:center;flex-wrap:wrap}.gallery-tool__add-buttons .cdx-button{display:inline-flex;align-items:center;gap:6px}.gallery-tool__add-buttons .cdx-button svg{width:16px;height:16px}.gallery-tool__url-input-wrapper{flex:1;min-width:200px}.gallery-tool__url-input{width:100%;padding:8px 12px;border:1px solid var(--border-color);border-radius:4px;font-size:14px}.gallery-tool__url-input:focus{border-color:var(--accent-color);outline:none}.gallery-tool__columns-control{display:flex;align-items:center;gap:8px;margin-left:auto}.gallery-tool__columns-button{width:28px;height:28px;border:1px solid var(--border-color);border-radius:4px;background:#fff;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:background .2s}.gallery-tool__columns-button:hover{background:var(--bg-color)}.gallery-tool__columns-display{font-size:13px;color:#666;min-width:45px;text-align:center}.gallery-tool--carousel{max-width:100%;overflow:hidden;box-sizing:border-box}.gallery-tool--carousel .gallery-tool__items{flex-wrap:nowrap;overflow-x:auto;overflow-y:hidden;gap:12px;padding-bottom:8px;max-width:100%;box-sizing:border-box;scrollbar-width:thin;scrollbar-color:var(--border-color) transparent}.gallery-tool--carousel .gallery-tool__items::-webkit-scrollbar{height:6px}.gallery-tool--carousel .gallery-tool__items::-webkit-scrollbar-track{background:transparent}.gallery-tool--carousel .gallery-tool__items::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:3px}.gallery-tool--carousel .gallery-tool__item{flex:0 0 auto;width:260px;max-width:calc(100% - 24px);min-width:200px}.gallery-tool--carousel .gallery-tool__item-image img{max-height:280px}.gallery-tool--masonry .gallery-tool__items{display:block;column-count:2;column-gap:12px;max-width:100%}.gallery-tool--masonry.gallery-tool--columns-3 .gallery-tool__items{column-count:3}.gallery-tool--masonry.gallery-tool--columns-4 .gallery-tool__items{column-count:4}.gallery-tool--masonry.gallery-tool--columns-5 .gallery-tool__items{column-count:5}.gallery-tool--masonry .gallery-tool__item{width:100%;max-width:100%;margin-bottom:12px;break-inside:avoid}.gallery-tool--masonry .gallery-tool__item-image img{max-height:none;max-width:100%}.gallery-tool--empty .gallery-tool__items,.gallery-tool--loading .gallery-tool__item-image img{display:none}.gallery-tool--stretched .gallery-tool__item-image img{max-height:none}.gallery-tool__stretched-badge{display:inline-block;margin-bottom:8px;padding:4px 10px;background:var(--accent-color);color:#fff;font-size:12px;font-weight:500;border-radius:4px}')),document.head.appendChild(o)}}catch(l){console.error("vite-plugin-css-injected-by-js",l)}})();
(function(T,x){typeof exports=="object"&&typeof module<"u"?module.exports=x():typeof define=="function"&&define.amd?define(x):(T=typeof globalThis<"u"?globalThis:T||self,T.GalleryTool=x())})(this,function(){"use strict";const T='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><rect width="14" height="14" x="5" y="5" stroke="currentColor" stroke-width="2" rx="4"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.13968 15.32L8.69058 11.5661C9.02934 11.2036 9.48873 11 9.96774 11C10.4467 11 10.9061 11.2036 11.2449 11.5661L15.3871 16M13.5806 14.0664L15.0132 12.533C15.3519 12.1705 15.8113 11.9668 16.2903 11.9668C16.7693 11.9668 17.2287 12.1705 17.5675 12.533L18.841 13.9634"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.7778 9.33331H13.7867"/></svg>',x='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9L20 12L17 15"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 12H20"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 9L4 12L7 15"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12H10"/></svg>';function S(L,e=null,t={}){const s=document.createElement(L);Array.isArray(e)?s.classList.add(...e):e!==null&&s.classList.add(e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i]);return s}const k=class k{constructor({api:e,config:t,onSelectFile:s,onSelectUrl:i,onColumnsChange:r,onRemoveImage:n,readOnly:u}){this.currentColumns=1,this.previousColumns=1,this.api=e,this.config=t,this.onSelectFile=s,this.onSelectUrl=i,this.onColumnsChange=r,this.onRemoveImage=n,this.readOnly=u,this.nodes={wrapper:S("div",[this.CSS.wrapper]),itemsContainer:S("div",[this.CSS.itemsContainer]),addButtons:S("div",[this.CSS.addButtons]),fileButton:this.createFileButton(),urlButton:S("div"),urlInput:this.createUrlInput(),columnsControl:this.createColumnsControl()},this.nodes.addButtons.appendChild(this.nodes.fileButton),this.nodes.addButtons.appendChild(this.nodes.urlInput),this.nodes.addButtons.appendChild(this.nodes.columnsControl),this.nodes.wrapper.appendChild(this.nodes.itemsContainer),this.nodes.wrapper.appendChild(this.nodes.addButtons)}get CSS(){return{wrapper:"gallery-tool",itemsContainer:"gallery-tool__items",item:"gallery-tool__item",itemImage:"gallery-tool__item-image",itemPreloader:"gallery-tool__item-preloader",itemDimensions:"gallery-tool__item-dimensions",itemCaption:"gallery-tool__item-caption",itemSource:"gallery-tool__item-source",itemSourceLink:"gallery-tool__item-source-link",itemControls:"gallery-tool__item-controls",itemRemove:"gallery-tool__item-remove",itemMoveLeft:"gallery-tool__item-move-left",itemMoveRight:"gallery-tool__item-move-right",addButtons:"gallery-tool__add-buttons",button:this.api.styles.button,input:this.api.styles.input,urlInput:"gallery-tool__url-input",urlInputWrapper:"gallery-tool__url-input-wrapper",columnsControl:"gallery-tool__columns-control",columnsButton:"gallery-tool__columns-button",columnsDisplay:"gallery-tool__columns-display"}}render(e,t){return this.currentColumns=t,this.updateColumnsClass(),e.length===0?this.toggleState("empty"):(e.forEach(s=>this.addItem(s)),this.toggleState("filled")),this.nodes.wrapper}addItem(e){const t=S("div",[this.CSS.item]),s=S("div",[this.CSS.itemImage]),i=S("div",[this.CSS.itemPreloader]),r=S("img",null,{src:e.url}),n=S("div",[this.CSS.itemCaption,this.CSS.input],{contentEditable:!this.readOnly});n.dataset.placeholder=this.config.captionPlaceholder??"Caption",n.textContent=e.caption||"";const u=S("div",[this.CSS.itemSource,this.CSS.input],{contentEditable:!this.readOnly});u.dataset.placeholder=this.config.sourcePlaceholder??"Source",u.textContent=e.source||"";const v=S("div",[this.CSS.itemSourceLink,this.CSS.input],{contentEditable:!this.readOnly});if(v.dataset.placeholder=this.config.sourceLinkPlaceholder??"Source link",v.textContent=e.sourceLink||"",s.appendChild(i),s.appendChild(r),e.width&&e.height){const l=S("div",[this.CSS.itemDimensions]);l.textContent=`${e.width} × ${e.height}`,s.appendChild(l)}if(r.onload=()=>{i.style.display="none"},!this.readOnly){const l=this.createItemControls(t);t.appendChild(l)}return t.appendChild(s),t.appendChild(n),t.appendChild(u),t.appendChild(v),t.dataset.url=e.url,e.width&&(t.dataset.width=String(e.width)),e.height&&(t.dataset.height=String(e.height)),this.nodes.itemsContainer.appendChild(t),this.toggleState("filled"),this.autoAdjustColumns(),t}createLoadingItem(e){const t=S("div",[this.CSS.item]),s=S("div",[this.CSS.itemImage]),i=S("div",[this.CSS.itemPreloader]);e&&(i.style.backgroundImage=`url(${e})`),s.appendChild(i),t.appendChild(s);const r=S("div",[this.CSS.itemCaption,this.CSS.input],{contentEditable:!this.readOnly});r.dataset.placeholder=this.config.captionPlaceholder??"Caption";const n=S("div",[this.CSS.itemSource,this.CSS.input],{contentEditable:!this.readOnly});n.dataset.placeholder=this.config.sourcePlaceholder??"Source";const u=S("div",[this.CSS.itemSourceLink,this.CSS.input],{contentEditable:!this.readOnly});return u.dataset.placeholder=this.config.sourceLinkPlaceholder??"Source link",t.appendChild(r),t.appendChild(n),t.appendChild(u),this.nodes.itemsContainer.appendChild(t),this.toggleState("loading"),t}fillLoadingItem(e,t){const s=e.querySelector(`.${this.CSS.itemImage}`),i=e.querySelector(`.${this.CSS.itemPreloader}`),r=S("img",null,{src:t.url});if(r.onload=()=>{i&&(i.style.display="none")},s.appendChild(r),t.width&&t.height){const n=S("div",[this.CSS.itemDimensions]);n.textContent=`${t.width} × ${t.height}`,s.appendChild(n)}if(e.dataset.url=t.url,t.width&&(e.dataset.width=String(t.width)),t.height&&(e.dataset.height=String(t.height)),!this.readOnly){const n=this.createItemControls(e);e.insertBefore(n,e.firstChild)}this.toggleState("filled"),this.autoAdjustColumns()}getItemsData(){const e=this.nodes.itemsContainer.querySelectorAll(`.${this.CSS.item}`),t=[];return e.forEach(s=>{var h,g,y;const i=s,r=i.dataset.url;if(!r)return;const n=((h=s.querySelector(`.${this.CSS.itemCaption}`))==null?void 0:h.textContent)||"",u=((g=s.querySelector(`.${this.CSS.itemSource}`))==null?void 0:g.textContent)||"",v=((y=s.querySelector(`.${this.CSS.itemSourceLink}`))==null?void 0:y.textContent)||"",l=i.dataset.width?parseInt(i.dataset.width,10):void 0,p=i.dataset.height?parseInt(i.dataset.height,10):void 0;t.push({url:r,caption:n,source:u,sourceLink:v,width:l,height:p})}),t}getColumns(){return this.currentColumns}createFileButton(){const e=S("div",[this.CSS.button]);return e.innerHTML=`${T} ${this.config.buttonContent}`,e.addEventListener("click",()=>this.onSelectFile()),e}createUrlInput(){const e=S("div",[this.CSS.urlInputWrapper]),t=S("input",[this.CSS.urlInput,this.CSS.input],{type:"text"});return t.placeholder=this.config.urlInputPlaceholder??"Вставьте ссылку на изображение",t.addEventListener("keydown",s=>{s.key==="Enter"&&(s.preventDefault(),this.handleUrlInput(t))}),t.addEventListener("paste",s=>{setTimeout(()=>{this.handleUrlInput(t)},50)}),e.appendChild(t),e}handleUrlInput(e){const t=e.value.trim();t&&this.isValidImageUrl(t)&&(this.onSelectUrl(t),e.value="")}createColumnsControl(){const e=S("div",[this.CSS.columnsControl]),t=S("button",[this.CSS.columnsButton]);t.innerHTML="−",t.addEventListener("click",()=>this.changeColumns(-1));const s=S("span",[this.CSS.columnsDisplay]);s.textContent=`${this.currentColumns} col`;const i=S("button",[this.CSS.columnsButton]);return i.innerHTML="+",i.addEventListener("click",()=>this.changeColumns(1)),e.appendChild(t),e.appendChild(s),e.appendChild(i),e}changeColumns(e){const t=Math.min(k.MAX_COLUMNS,Math.max(k.MIN_COLUMNS,this.currentColumns+e));t!==this.currentColumns&&(this.previousColumns=this.currentColumns,this.currentColumns=t,this.updateColumnsClass(),this.updateColumnsDisplay(),this.onColumnsChange(t))}updateColumnsClass(){const e=`gallery-tool--columns-${this.previousColumns}`,t=`gallery-tool--columns-${this.currentColumns}`;if(this.nodes.wrapper.classList.contains(e))this.nodes.wrapper.classList.replace(e,t);else{for(let s=k.MIN_COLUMNS;s<=k.MAX_COLUMNS;s++)this.nodes.wrapper.classList.remove(`gallery-tool--columns-${s}`);this.nodes.wrapper.classList.add(t)}}isValidImageUrl(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:image/")}updateColumnsDisplay(){const e=this.nodes.columnsControl.querySelector(`.${this.CSS.columnsDisplay}`);e&&(e.textContent=`${this.currentColumns} col`)}autoAdjustColumns(){const t=this.nodes.itemsContainer.children.length<=1?1:2;t!==this.currentColumns&&(this.previousColumns=this.currentColumns,this.currentColumns=t,this.updateColumnsClass(),this.updateColumnsDisplay(),this.onColumnsChange(t))}createItemControls(e){const t=S("div",[this.CSS.itemControls]),s=S("button",[this.CSS.itemRemove]);s.innerHTML="×",s.addEventListener("click",()=>{const n=e.dataset.url;n&&this.onRemoveImage(n),e.remove(),this.nodes.itemsContainer.children.length===0&&this.toggleState("empty"),this.autoAdjustColumns()});const i=S("button",[this.CSS.itemMoveLeft]);i.innerHTML="←",i.addEventListener("click",()=>this.moveItem(e,-1));const r=S("button",[this.CSS.itemMoveRight]);return r.innerHTML="→",r.addEventListener("click",()=>this.moveItem(e,1)),t.appendChild(i),t.appendChild(s),t.appendChild(r),t}moveItem(e,t){const s=Array.from(this.nodes.itemsContainer.children),r=s.indexOf(e)+t;r<0||r>=s.length||(t<0?this.nodes.itemsContainer.insertBefore(e,s[r]):this.nodes.itemsContainer.insertBefore(s[r],e))}toggleState(e){this.nodes.wrapper.classList.remove("gallery-tool--empty","gallery-tool--loading","gallery-tool--filled"),this.nodes.wrapper.classList.add(`gallery-tool--${e}`)}applyTune(e,t){this.nodes.wrapper.classList.toggle(`gallery-tool--${e}`,t),e==="stretched"&&this.updateStretchedBadge(t)}updateStretchedBadge(e){const t=this.nodes.wrapper.querySelector(".gallery-tool__stretched-badge");if(e&&!t){const s=S("div",["gallery-tool__stretched-badge"]);s.textContent="Обложка",this.nodes.wrapper.insertBefore(s,this.nodes.wrapper.firstChild)}else!e&&t&&t.remove()}};k.MIN_COLUMNS=1,k.MAX_COLUMNS=5;let M=k;function R(L){return L&&L.__esModule&&Object.prototype.hasOwnProperty.call(L,"default")?L.default:L}var U={exports:{}};(function(L,e){(function(t,s){L.exports=s()})(window,function(){return function(t){var s={};function i(r){if(s[r])return s[r].exports;var n=s[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=s,i.d=function(r,n,u){i.o(r,n)||Object.defineProperty(r,n,{enumerable:!0,get:u})},i.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},i.t=function(r,n){if(1&n&&(r=i(r)),8&n||4&n&&typeof r=="object"&&r&&r.__esModule)return r;var u=Object.create(null);if(i.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:r}),2&n&&typeof r!="string")for(var v in r)i.d(u,v,(function(l){return r[l]}).bind(null,v));return u},i.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return i.d(n,"a",n),n},i.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},i.p="",i(i.s=3)}([function(t,s){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}t.exports=i},function(t,s,i){(function(r){var n=i(2),u=setTimeout;function v(){}function l(a){if(!(this instanceof l))throw new TypeError("Promises must be constructed via new");if(typeof a!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],o(a,this)}function p(a,d){for(;a._state===3;)a=a._value;a._state!==0?(a._handled=!0,l._immediateFn(function(){var c=a._state===1?d.onFulfilled:d.onRejected;if(c!==null){var C;try{C=c(a._value)}catch(m){return void g(d.promise,m)}h(d.promise,C)}else(a._state===1?h:g)(d.promise,a._value)})):a._deferreds.push(d)}function h(a,d){try{if(d===a)throw new TypeError("A promise cannot be resolved with itself.");if(d&&(typeof d=="object"||typeof d=="function")){var c=d.then;if(d instanceof l)return a._state=3,a._value=d,void y(a);if(typeof c=="function")return void o((C=c,m=d,function(){C.apply(m,arguments)}),a)}a._state=1,a._value=d,y(a)}catch(f){g(a,f)}var C,m}function g(a,d){a._state=2,a._value=d,y(a)}function y(a){a._state===2&&a._deferreds.length===0&&l._immediateFn(function(){a._handled||l._unhandledRejectionFn(a._value)});for(var d=0,c=a._deferreds.length;d<c;d++)p(a,a._deferreds[d]);a._deferreds=null}function w(a,d,c){this.onFulfilled=typeof a=="function"?a:null,this.onRejected=typeof d=="function"?d:null,this.promise=c}function o(a,d){var c=!1;try{a(function(C){c||(c=!0,h(d,C))},function(C){c||(c=!0,g(d,C))})}catch(C){if(c)return;c=!0,g(d,C)}}l.prototype.catch=function(a){return this.then(null,a)},l.prototype.then=function(a,d){var c=new this.constructor(v);return p(this,new w(a,d,c)),c},l.prototype.finally=n.a,l.all=function(a){return new l(function(d,c){if(!a||a.length===void 0)throw new TypeError("Promise.all accepts an array");var C=Array.prototype.slice.call(a);if(C.length===0)return d([]);var m=C.length;function f(E,_){try{if(_&&(typeof _=="object"||typeof _=="function")){var I=_.then;if(typeof I=="function")return void I.call(_,function(P){f(E,P)},c)}C[E]=_,--m==0&&d(C)}catch(P){c(P)}}for(var b=0;b<C.length;b++)f(b,C[b])})},l.resolve=function(a){return a&&typeof a=="object"&&a.constructor===l?a:new l(function(d){d(a)})},l.reject=function(a){return new l(function(d,c){c(a)})},l.race=function(a){return new l(function(d,c){for(var C=0,m=a.length;C<m;C++)a[C].then(d,c)})},l._immediateFn=typeof r=="function"&&function(a){r(a)}||function(a){u(a,0)},l._unhandledRejectionFn=function(a){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",a)},s.a=l}).call(this,i(5).setImmediate)},function(t,s,i){s.a=function(r){var n=this.constructor;return this.then(function(u){return n.resolve(r()).then(function(){return u})},function(u){return n.resolve(r()).then(function(){return n.reject(u)})})}},function(t,s,i){function r(o){return(r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(o)}i(4);var n,u,v,l,p,h,g,y=i(8),w=(u=function(o){return new Promise(function(a,d){o=l(o),(o=p(o)).beforeSend&&o.beforeSend();var c=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");c.open(o.method,o.url),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(o.headers).forEach(function(m){var f=o.headers[m];c.setRequestHeader(m,f)});var C=o.ratio;c.upload.addEventListener("progress",function(m){var f=Math.round(m.loaded/m.total*100),b=Math.ceil(f*C/100);o.progress(Math.min(b,100))},!1),c.addEventListener("progress",function(m){var f=Math.round(m.loaded/m.total*100),b=Math.ceil(f*(100-C)/100)+C;o.progress(Math.min(b,100))},!1),c.onreadystatechange=function(){if(c.readyState===4){var m=c.response;try{m=JSON.parse(m)}catch{}var f=y.parseHeaders(c.getAllResponseHeaders()),b={body:m,code:c.status,headers:f};g(c.status)?a(b):d(b)}},c.send(o.data)})},v=function(o){return o.method="POST",u(o)},l=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(o.url&&typeof o.url!="string")throw new Error("Url must be a string");if(o.url=o.url||"",o.method&&typeof o.method!="string")throw new Error("`method` must be a string or null");if(o.method=o.method?o.method.toUpperCase():"GET",o.headers&&r(o.headers)!=="object")throw new Error("`headers` must be an object or null");if(o.headers=o.headers||{},o.type&&(typeof o.type!="string"||!Object.values(n).includes(o.type)))throw new Error("`type` must be taken from module's «contentType» library");if(o.progress&&typeof o.progress!="function")throw new Error("`progress` must be a function or null");if(o.progress=o.progress||function(a){},o.beforeSend=o.beforeSend||function(a){},o.ratio&&typeof o.ratio!="number")throw new Error("`ratio` must be a number");if(o.ratio<0||o.ratio>100)throw new Error("`ratio` must be in a 0-100 interval");if(o.ratio=o.ratio||90,o.accept&&typeof o.accept!="string")throw new Error("`accept` must be a string with a list of allowed mime-types");if(o.accept=o.accept||"*/*",o.multiple&&typeof o.multiple!="boolean")throw new Error("`multiple` must be a true or false");if(o.multiple=o.multiple||!1,o.fieldName&&typeof o.fieldName!="string")throw new Error("`fieldName` must be a string");return o.fieldName=o.fieldName||"files",o},p=function(o){switch(o.method){case"GET":var a=h(o.data,n.URLENCODED);delete o.data,o.url=/\?/.test(o.url)?o.url+"&"+a:o.url+"?"+a;break;case"POST":case"PUT":case"DELETE":case"UPDATE":var d=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).type||n.JSON}(o);(y.isFormData(o.data)||y.isFormElement(o.data))&&(d=n.FORM),o.data=h(o.data,d),d!==w.contentType.FORM&&(o.headers["content-type"]=d)}return o},h=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};switch(arguments.length>1?arguments[1]:void 0){case n.URLENCODED:return y.urlEncode(o);case n.JSON:return y.jsonEncode(o);case n.FORM:return y.formEncode(o);default:return o}},g=function(o){return o>=200&&o<300},{contentType:n={URLENCODED:"application/x-www-form-urlencoded; charset=utf-8",FORM:"multipart/form-data",JSON:"application/json; charset=utf-8"},request:u,get:function(o){return o.method="GET",u(o)},post:v,transport:function(o){return o=l(o),y.selectFiles(o).then(function(a){for(var d=new FormData,c=0;c<a.length;c++)d.append(o.fieldName,a[c],a[c].name);y.isObject(o.data)&&Object.keys(o.data).forEach(function(m){var f=o.data[m];d.append(m,f)});var C=o.beforeSend;return o.beforeSend=function(){return C(a)},o.data=d,v(o)})},selectFiles:function(o){return delete(o=l(o)).beforeSend,y.selectFiles(o)}});t.exports=w},function(t,s,i){i.r(s);var r=i(1);window.Promise=window.Promise||r.a},function(t,s,i){(function(r){var n=r!==void 0&&r||typeof self<"u"&&self||window,u=Function.prototype.apply;function v(l,p){this._id=l,this._clearFn=p}s.setTimeout=function(){return new v(u.call(setTimeout,n,arguments),clearTimeout)},s.setInterval=function(){return new v(u.call(setInterval,n,arguments),clearInterval)},s.clearTimeout=s.clearInterval=function(l){l&&l.close()},v.prototype.unref=v.prototype.ref=function(){},v.prototype.close=function(){this._clearFn.call(n,this._id)},s.enroll=function(l,p){clearTimeout(l._idleTimeoutId),l._idleTimeout=p},s.unenroll=function(l){clearTimeout(l._idleTimeoutId),l._idleTimeout=-1},s._unrefActive=s.active=function(l){clearTimeout(l._idleTimeoutId);var p=l._idleTimeout;p>=0&&(l._idleTimeoutId=setTimeout(function(){l._onTimeout&&l._onTimeout()},p))},i(6),s.setImmediate=typeof self<"u"&&self.setImmediate||r!==void 0&&r.setImmediate||this&&this.setImmediate,s.clearImmediate=typeof self<"u"&&self.clearImmediate||r!==void 0&&r.clearImmediate||this&&this.clearImmediate}).call(this,i(0))},function(t,s,i){(function(r,n){(function(u,v){if(!u.setImmediate){var l,p,h,g,y,w=1,o={},a=!1,d=u.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(u);c=c&&c.setTimeout?c:u,{}.toString.call(u.process)==="[object process]"?l=function(f){n.nextTick(function(){m(f)})}:function(){if(u.postMessage&&!u.importScripts){var f=!0,b=u.onmessage;return u.onmessage=function(){f=!1},u.postMessage("","*"),u.onmessage=b,f}}()?(g="setImmediate$"+Math.random()+"$",y=function(f){f.source===u&&typeof f.data=="string"&&f.data.indexOf(g)===0&&m(+f.data.slice(g.length))},u.addEventListener?u.addEventListener("message",y,!1):u.attachEvent("onmessage",y),l=function(f){u.postMessage(g+f,"*")}):u.MessageChannel?((h=new MessageChannel).port1.onmessage=function(f){m(f.data)},l=function(f){h.port2.postMessage(f)}):d&&"onreadystatechange"in d.createElement("script")?(p=d.documentElement,l=function(f){var b=d.createElement("script");b.onreadystatechange=function(){m(f),b.onreadystatechange=null,p.removeChild(b),b=null},p.appendChild(b)}):l=function(f){setTimeout(m,0,f)},c.setImmediate=function(f){typeof f!="function"&&(f=new Function(""+f));for(var b=new Array(arguments.length-1),E=0;E<b.length;E++)b[E]=arguments[E+1];var _={callback:f,args:b};return o[w]=_,l(w),w++},c.clearImmediate=C}function C(f){delete o[f]}function m(f){if(a)setTimeout(m,0,f);else{var b=o[f];if(b){a=!0;try{(function(E){var _=E.callback,I=E.args;switch(I.length){case 0:_();break;case 1:_(I[0]);break;case 2:_(I[0],I[1]);break;case 3:_(I[0],I[1],I[2]);break;default:_.apply(v,I)}})(b)}finally{C(f),a=!1}}}}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,i(0),i(7))},function(t,s){var i,r,n=t.exports={};function u(){throw new Error("setTimeout has not been defined")}function v(){throw new Error("clearTimeout has not been defined")}function l(c){if(i===setTimeout)return setTimeout(c,0);if((i===u||!i)&&setTimeout)return i=setTimeout,setTimeout(c,0);try{return i(c,0)}catch{try{return i.call(null,c,0)}catch{return i.call(this,c,0)}}}(function(){try{i=typeof setTimeout=="function"?setTimeout:u}catch{i=u}try{r=typeof clearTimeout=="function"?clearTimeout:v}catch{r=v}})();var p,h=[],g=!1,y=-1;function w(){g&&p&&(g=!1,p.length?h=p.concat(h):y=-1,h.length&&o())}function o(){if(!g){var c=l(w);g=!0;for(var C=h.length;C;){for(p=h,h=[];++y<C;)p&&p[y].run();y=-1,C=h.length}p=null,g=!1,function(m){if(r===clearTimeout)return clearTimeout(m);if((r===v||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(m);try{r(m)}catch{try{return r.call(null,m)}catch{return r.call(this,m)}}}(c)}}function a(c,C){this.fun=c,this.array=C}function d(){}n.nextTick=function(c){var C=new Array(arguments.length-1);if(arguments.length>1)for(var m=1;m<arguments.length;m++)C[m-1]=arguments[m];h.push(new a(c,C)),h.length!==1||g||l(o)},a.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=d,n.addListener=d,n.once=d,n.off=d,n.removeListener=d,n.removeAllListeners=d,n.emit=d,n.prependListener=d,n.prependOnceListener=d,n.listeners=function(c){return[]},n.binding=function(c){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(c){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,s,i){function r(u,v){for(var l=0;l<v.length;l++){var p=v[l];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(u,p.key,p)}}var n=i(9);t.exports=function(){function u(){(function(h,g){if(!(h instanceof g))throw new TypeError("Cannot call a class as a function")})(this,u)}var v,l,p;return v=u,p=[{key:"urlEncode",value:function(h){return n(h)}},{key:"jsonEncode",value:function(h){return JSON.stringify(h)}},{key:"formEncode",value:function(h){if(this.isFormData(h))return h;if(this.isFormElement(h))return new FormData(h);if(this.isObject(h)){var g=new FormData;return Object.keys(h).forEach(function(y){var w=h[y];g.append(y,w)}),g}throw new Error("`data` must be an instance of Object, FormData or <FORM> HTMLElement")}},{key:"isObject",value:function(h){return Object.prototype.toString.call(h)==="[object Object]"}},{key:"isFormData",value:function(h){return h instanceof FormData}},{key:"isFormElement",value:function(h){return h instanceof HTMLFormElement}},{key:"selectFiles",value:function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise(function(g,y){var w=document.createElement("INPUT");w.type="file",h.multiple&&w.setAttribute("multiple","multiple"),h.accept&&w.setAttribute("accept",h.accept),w.style.display="none",document.body.appendChild(w),w.addEventListener("change",function(o){var a=o.target.files;g(a),document.body.removeChild(w)},!1),w.click()})}},{key:"parseHeaders",value:function(h){var g=h.trim().split(/[\r\n]+/),y={};return g.forEach(function(w){var o=w.split(": "),a=o.shift(),d=o.join(": ");a&&(y[a]=d)}),y}}],(l=null)&&r(v.prototype,l),p&&r(v,p),u}()},function(t,s){var i=function(n){return encodeURIComponent(n).replace(/[!'()*]/g,escape).replace(/%20/g,"+")},r=function(n,u,v,l){return u=u||null,v=v||"&",l=l||null,n?function(p){for(var h=new Array,g=0;g<p.length;g++)p[g]&&h.push(p[g]);return h}(Object.keys(n).map(function(p){var h,g,y=p;if(l&&(y=l+"["+y+"]"),typeof n[p]=="object"&&n[p]!==null)h=r(n[p],null,v,y);else{u&&(g=y,y=!isNaN(parseFloat(g))&&isFinite(g)?u+Number(y):y);var w=n[p];w=(w=(w=(w=w===!0?"1":w)===!1?"0":w)===0?"0":w)||"",h=i(y)+"="+i(w)}return h})).join(v).replace(/[!'()*]/g,""):""};t.exports=r}])})})(U);var B=U.exports;const F=R(B);function j(L){return L!==void 0&&typeof L.then=="function"}class D{constructor({config:e,onUpload:t,onError:s}){this.config=e,this.onUpload=t,this.onError=s}uploadSelectedFile({onPreview:e}){var i;const t=r=>{const n=new FileReader;n.readAsDataURL(r),n.onload=u=>{e(u.target.result)},n.onerror=()=>{this.onError("Failed to read file")}};let s;if((i=this.config.uploader)!=null&&i.uploadByFile)s=F.selectFiles({accept:this.config.types??"image/*"}).then(r=>{if(!r||r.length===0)throw new Error("No file selected");t(r[0]);const n=this.config.uploader.uploadByFile(r[0]);return j(n)||console.warn("Custom uploader method uploadByFile should return a Promise"),n});else{if(!this.config.endpoints.byFile){this.onError("Upload endpoint (byFile) is not configured");return}s=F.transport({url:this.config.endpoints.byFile,data:this.config.additionalRequestData,accept:this.config.types??"image/*",headers:this.config.additionalRequestHeaders,beforeSend:r=>{r&&r.length>0&&t(r[0])},fieldName:this.config.field??"image"}).then(r=>r.body)}s.then(r=>this.onUpload(r)).catch(r=>this.onError(r))}uploadByUrl(e){var s;let t;if((s=this.config.uploader)!=null&&s.uploadByUrl)t=this.config.uploader.uploadByUrl(e),j(t)||console.warn("Custom uploader method uploadByUrl should return a Promise");else{if(!this.config.endpoints.byUrl){this.onError("Upload endpoint (byUrl) is not configured");return}t=F.post({url:this.config.endpoints.byUrl,data:{url:e,...this.config.additionalRequestData},type:F.contentType.JSON,headers:this.config.additionalRequestHeaders}).then(i=>i.body)}t.then(i=>this.onUpload(i)).catch(i=>this.onError(i))}uploadByFile(e,{onPreview:t}){var r;const s=new FileReader;s.readAsDataURL(e),s.onload=n=>{t(n.target.result)},s.onerror=()=>{this.onError("Failed to read file")};let i;if((r=this.config.uploader)!=null&&r.uploadByFile)i=this.config.uploader.uploadByFile(e),j(i)||console.warn("Custom uploader method uploadByFile should return a Promise");else{if(!this.config.endpoints.byFile){this.onError("Upload endpoint (byFile) is not configured");return}const n=new FormData;n.append(this.config.field??"image",e),this.config.additionalRequestData&&Object.entries(this.config.additionalRequestData).forEach(([u,v])=>{n.append(u,v)}),i=F.post({url:this.config.endpoints.byFile,data:n,type:F.contentType.JSON,headers:this.config.additionalRequestHeaders}).then(u=>u.body)}i.then(n=>this.onUpload(n)).catch(n=>this.onError(n))}}/**
 * Gallery Tool for Editor.js
 * Supports multiple images with captions and source attribution
 * @author iXBT
 * @license MIT
 */class O{constructor({data:e,config:t,api:s,readOnly:i,block:r}){this.currentLoadingItem=null,this.api=s,this.readOnly=i,this.block=r,this.config={endpoints:t.endpoints??{},additionalRequestData:t.additionalRequestData,additionalRequestHeaders:t.additionalRequestHeaders,field:t.field??"image",types:t.types??"image/*",captionPlaceholder:this.api.i18n.t(t.captionPlaceholder??"Caption"),sourcePlaceholder:this.api.i18n.t(t.sourcePlaceholder??"Source"),sourceLinkPlaceholder:this.api.i18n.t(t.sourceLinkPlaceholder??"Source link"),buttonContent:t.buttonContent??this.api.i18n.t("Add Image"),urlButtonContent:t.urlButtonContent??this.api.i18n.t("Add from URL"),uploader:t.uploader},this.uploader=new D({config:this.config,onUpload:n=>this.onUpload(n),onError:n=>this.uploadingFailed(n)}),this.ui=new M({api:s,config:this.config,onSelectFile:()=>this.selectFile(),onSelectUrl:n=>this.uploadFromUrl(n),onColumnsChange:n=>this.onColumnsChange(n),onRemoveImage:n=>this.onRemoveImage(n),readOnly:i}),this._data={items:(e==null?void 0:e.items)??[],layout:(e==null?void 0:e.layout)??"grid",columns:(e==null?void 0:e.columns)??3,stretched:(e==null?void 0:e.stretched)??!1}}static get isReadOnlySupported(){return!0}static get toolbox(){return{icon:T,title:"Gallery"}}static get tunes(){return[{name:"stretched",icon:x,title:"Stretch image",toggle:!0}]}static get pasteConfig(){return{tags:[{img:{src:!0}}],patterns:{image:/https?:\/\/\S+\.(gif|jpe?g|tiff|png|svg|webp)(\?[a-z0-9=]*)?$/i},files:{mimeTypes:["image/*"]}}}render(){const e=this.ui.render(this._data.items,this._data.columns);return O.tunes.forEach(({name:t})=>{const s=this._data[t];s&&this.setTune(t,s)}),e}appendCallback(){this.ui.nodes.fileButton.click()}validate(e){return e.items.length>0}save(){return this._data.items=this.ui.getItemsData(),this._data.columns=this.ui.getColumns(),this._data}renderSettings(){const e=O.tunes.map(i=>({icon:i.icon,label:this.api.i18n.t(i.title),name:i.name,toggle:i.toggle,isActive:this._data[i.name],onActivate:()=>{this.tuneToggled(i.name)}})),s=[{name:"grid",title:"Grid",icon:this.getGridIcon()},{name:"carousel",title:"Carousel",icon:this.getCarouselIcon()},{name:"masonry",title:"Masonry",icon:this.getMasonryIcon()}].map(i=>({icon:i.icon,label:this.api.i18n.t(i.title),name:i.name,isActive:this._data.layout===i.name,onActivate:()=>{this._data.layout=i.name,this.updateLayoutClass()}}));return[...e,...s]}async onPaste(e){switch(e.type){case"tag":{const t=e.detail.data;if(/^blob:/.test(t.src)){const i=await(await fetch(t.src)).blob();this.uploadFile(i)}else this.uploadFromUrl(t.src);break}case"pattern":{const t=e.detail.data;this.uploadFromUrl(t);break}case"file":{const t=e.detail.file;this.uploadFile(t);break}}}selectFile(){this.uploader.uploadSelectedFile({onPreview:e=>{this.currentLoadingItem=this.ui.createLoadingItem(e)}})}uploadFile(e){this.uploader.uploadByFile(e,{onPreview:t=>{this.currentLoadingItem=this.ui.createLoadingItem(t)}})}uploadFromUrl(e){this.currentLoadingItem=this.ui.createLoadingItem(e),this.uploader.uploadByUrl(e)}onUpload(e){if(e.success&&e.file){const t={url:e.file.url,caption:"",source:"",sourceLink:"",width:e.file.width,height:e.file.height};this.currentLoadingItem?(this.ui.fillLoadingItem(this.currentLoadingItem,t),this.currentLoadingItem=null):this.ui.addItem(t)}else this.uploadingFailed("incorrect response: "+JSON.stringify(e))}uploadingFailed(e){console.error("Gallery Tool: uploading failed",e),this.currentLoadingItem&&(this.currentLoadingItem.remove(),this.currentLoadingItem=null),this.api.notifier.show({message:this.api.i18n.t("Couldn't upload image. Please try another."),style:"error"})}onColumnsChange(e){this._data.columns=e}onRemoveImage(e){const t=this.config.endpoints.deleteImage;!t||!e||fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...this.config.additionalRequestHeaders||{}},body:JSON.stringify({url:e})}).catch(s=>{console.error("Gallery Tool: failed to delete image from S3",s)})}updateLayoutClass(){const e=this.ui.nodes.wrapper;e.classList.remove("gallery-tool--grid","gallery-tool--carousel","gallery-tool--masonry"),e.classList.add(`gallery-tool--${this._data.layout}`)}tuneToggled(e){const t=this._data[e];this.setTune(e,!t)}setTune(e,t){e==="stretched"&&(this._data.stretched=t),this.ui.applyTune(e,t),e==="stretched"&&Promise.resolve().then(()=>{this.block.stretched=t}).catch(s=>{console.error(s)})}getGridIcon(){return'<svg width="17" height="15" viewBox="0 0 17 15" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="7" height="7" rx="1"/><rect x="9" y="0" width="7" height="7" rx="1"/><rect x="0" y="8" width="7" height="7" rx="1"/><rect x="9" y="8" width="7" height="7" rx="1"/></svg>'}getCarouselIcon(){return'<svg width="17" height="15" viewBox="0 0 17 15" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="0" width="11" height="15" rx="1"/><rect x="0" y="3" width="2" height="9" rx="1" opacity="0.5"/><rect x="15" y="3" width="2" height="9" rx="1" opacity="0.5"/></svg>'}getMasonryIcon(){return'<svg width="17" height="15" viewBox="0 0 17 15" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="7" height="9" rx="1"/><rect x="9" y="0" width="7" height="5" rx="1"/><rect x="0" y="10" width="7" height="5" rx="1"/><rect x="9" y="6" width="7" height="9" rx="1"/></svg>'}}return O});
